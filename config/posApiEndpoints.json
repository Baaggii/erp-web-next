[
  {
    "id": "saveReceipt",
    "name": "Save POS receipt",
    "usage": "transaction",
    "posApiType": "B2C",
    "method": "POST",
    "path": "/rest/receipt",
    "serverUrl": "{{POSAPI_BASE_URL}}",
    "testServerUrl": "https://posapi-test.tax.gov.mn",
    "supportsItems": true,
    "supportsMultipleReceipts": true,
    "supportsMultiplePayments": true,
    "defaultVariation": "B2C_RECEIPT",
    "nestedPaths": {
      "items": "items[]",
      "receipts": "receipts[]",
      "payments": "payments[]"
    },
    "requestFields": [
      { "field": "type", "label": "Receipt type", "required": true, "variationSpecific": true },
      { "field": "taxType", "label": "Tax type", "variationSpecific": true },
      { "field": "totalAmount", "label": "Total amount", "required": true },
      { "field": "totalVAT", "label": "Total VAT" },
      { "field": "totalCityTax", "label": "Total city tax" },
      { "field": "customerTin", "label": "Customer TIN" },
      { "field": "consumerNo", "label": "Consumer number" },
      { "field": "branchNo", "label": "Branch number" },
      { "field": "posNo", "label": "POS number" },
      { "field": "payments[].type", "label": "Payment type", "required": true },
      { "field": "payments[].paidAmount", "label": "Payment amount", "required": true },
      { "field": "items[].name", "label": "Item name", "required": true },
      { "field": "items[].qty", "label": "Quantity", "required": true },
      { "field": "items[].measureUnitPrice", "label": "Unit price", "required": true },
      { "field": "items[].taxProductCode", "label": "Tax product code" },
      { "field": "items[].classificationCode", "label": "Classification code" }
    ],
    "mappingHints": {
      "nestedPaths": {
        "items": "items[]",
        "payments": "payments[]",
        "receipts": "receipts[]"
      },
      "topLevelFields": [
        { "field": "type", "required": true, "variationSpecific": true },
        { "field": "taxType", "variationSpecific": true },
        { "field": "totalAmount", "required": true },
        { "field": "totalVAT" },
        { "field": "totalCityTax" },
        { "field": "customerTin" },
        { "field": "consumerNo" },
        { "field": "branchNo", "required": true },
        { "field": "posNo", "required": true },
        { "field": "items[]" }
      ],
      "itemFields": [
        { "field": "name", "required": true },
        { "field": "description" },
        { "field": "qty", "required": true },
        { "field": "measureUnitPrice", "required": true },
        { "field": "totalAmount" },
        { "field": "totalVAT" },
        { "field": "totalCityTax" },
        { "field": "taxType" },
        { "field": "classificationCode" },
        { "field": "taxProductCode" }
      ],
      "paymentFields": [
        { "field": "type", "required": true },
        { "field": "paidAmount", "required": true },
        { "field": "reference" },
        { "field": "currency" }
      ],
      "receiptFields": [
        { "field": "totalAmount" },
        { "field": "totalVAT" },
        { "field": "totalCityTax" },
        { "field": "taxType" }
      ]
    },
    "requestMappings": {
      "type": { "type": "literal", "value": "B2C_RECEIPT" },
      "taxType": { "type": "literal", "value": "VAT_ABLE" },
      "totalAmount": { "type": "column", "column": "total_amount" },
      "totalVAT": { "type": "column", "column": "total_vat" },
      "totalCityTax": { "type": "column", "column": "total_city_tax" },
      "customerTin": { "type": "column", "column": "customer_tin" },
      "consumerNo": { "type": "column", "column": "consumer_no" },
      "branchNo": { "type": "session", "sessionVar": "branchId" },
      "posNo": { "type": "session", "sessionVar": "posNo" },
      "payments[].type": { "type": "column", "column": "payment_type" },
      "payments[].paidAmount": { "type": "column", "column": "paid_amount" },
      "items[].name": { "type": "column", "column": "item_name" },
      "items[].qty": { "type": "column", "column": "qty" },
      "items[].measureUnitPrice": { "type": "column", "column": "unit_price" }
    },
    "responseFields": [
      {
        "path": "id",
        "label": "Submission ID",
        "destField": "ebarimt_invoice_id",
        "type": "string",
        "description": "Root id returned by POSAPI"
      },
      {
        "path": "qrData",
        "label": "QR data",
        "destField": "qr_data",
        "type": "string",
        "description": "Base64 QR payload for printing"
      },
      {
        "path": "lottery",
        "label": "Lottery number",
        "destField": "lottery",
        "type": "string"
      },
      {
        "path": "receipts[].id",
        "label": "Receipt ID",
        "destField": "receipt_id",
        "type": "string"
      },
      {
        "path": "receipts[].qrData",
        "label": "Receipt QR",
        "destField": "receipt_qr_data",
        "type": "string"
      },
      {
        "path": "receipts[].lottery",
        "label": "Receipt lottery number",
        "destField": "receipt_lottery",
        "type": "string"
      }
    ],
    "responseFieldMappings": {
      "id": { "type": "column", "column": "ebarimt_invoice_id" },
      "qrData": { "type": "column", "column": "qr_data" },
      "lottery": { "type": "column", "column": "lottery" },
      "receipts[].id": { "type": "column", "column": "receipt_id" },
      "receipts[].qrData": { "type": "column", "column": "receipt_qr_data" },
      "receipts[].lottery": { "type": "column", "column": "receipt_lottery" }
    },
    "aggregations": [
      {
        "target": "totalAmount",
        "source": "items[].measureUnitPrice",
        "operation": "sum",
        "label": "Sum of item unit prices"
      },
      {
        "target": "totalVAT",
        "source": "items[].totalVAT",
        "operation": "sum",
        "label": "Sum of item VAT"
      },
      {
        "target": "totalCityTax",
        "source": "items[].totalCityTax",
        "operation": "sum",
        "label": "Sum of item city tax"
      }
    ],
    "variationDefaults": {
      "type": {
        "B2C_RECEIPT": "B2C_RECEIPT",
        "B2B_RECEIPT": "B2B_RECEIPT",
        "B2B_PURCHASE": "B2B_PURCHASE"
      },
      "taxType": {
        "B2C_RECEIPT": "VAT_ABLE",
        "B2B_RECEIPT": "VAT_ABLE",
        "B2B_PURCHASE": "VAT_ABLE"
      }
    },
    "variations": [
      {
        "key": "B2C_RECEIPT",
        "name": "B2C receipt",
        "variationDefaults": {
          "type": "B2C_RECEIPT",
          "taxType": "VAT_ABLE"
        },
        "requestExample": {
          "type": "B2C_RECEIPT",
          "taxType": "VAT_ABLE",
          "totalAmount": 10000,
          "totalVAT": 1000,
          "payments": [
            { "type": "CASH", "paidAmount": 10000 }
          ],
          "items": [
            { "name": "Sample item", "qty": 1, "measureUnitPrice": 10000 }
          ]
        },
        "responseExample": {
          "id": "B2C-123",
          "qrData": "base64-qr",
          "lottery": "A1B2C3",
          "receipts": [
            { "id": "B2C-R1", "qrData": "base64-qr", "lottery": "A1B2C3" }
          ]
        }
      },
      {
        "key": "B2B_RECEIPT",
        "name": "B2B receipt",
        "variationDefaults": {
          "type": "B2B_RECEIPT",
          "taxType": "VAT_ABLE"
        },
        "requestExample": {
          "type": "B2B_RECEIPT",
          "taxType": "VAT_ABLE",
          "customerTin": "12345678",
          "totalAmount": 12000,
          "totalVAT": 1200,
          "payments": [
            { "type": "BANK_TRANSFER", "paidAmount": 12000 }
          ],
          "items": [
            { "name": "Service", "qty": 1, "measureUnitPrice": 12000 }
          ]
        }
      },
      {
        "key": "B2B_PURCHASE",
        "name": "B2B purchase",
        "variationDefaults": {
          "type": "B2B_PURCHASE",
          "taxType": "VAT_ABLE"
        },
        "requestExample": {
          "type": "B2B_PURCHASE",
          "taxType": "VAT_ABLE",
          "customerTin": "12345678",
          "totalAmount": 15000,
          "totalVAT": 1500,
          "payments": [
            { "type": "CARD", "paidAmount": 15000 }
          ],
          "items": [
            { "name": "Purchase item", "qty": 1, "measureUnitPrice": 15000 }
          ]
        }
      }
    ]
  },
  {
    "id": "getDistrictCodes",
    "name": "Reference district codes",
    "usage": "info",
    "method": "GET",
    "path": "/rest/getDistrictCode",
    "serverUrl": "{{POSAPI_BASE_URL}}",
    "testServerUrl": "https://posapi-test.tax.gov.mn",
    "responseFields": [
      { "path": "codes[].code", "label": "District code", "type": "string" },
      { "path": "codes[].name", "label": "District name", "type": "string" }
    ],
    "responseFieldMappings": {
      "codes[].code": { "type": "column", "column": "district_code" },
      "codes[].name": { "type": "column", "column": "district_name" }
    }
  },
  {
    "id": "getVatTaxTypes",
    "name": "Reference VAT tax types",
    "usage": "info",
    "method": "GET",
    "path": "/rest/vat_tax_type",
    "serverUrl": "{{POSAPI_BASE_URL}}",
    "testServerUrl": "https://posapi-test.tax.gov.mn",
    "responseFields": [
      { "path": "taxTypes[].code", "label": "VAT type code", "type": "string" },
      { "path": "taxTypes[].description", "label": "VAT type description", "type": "string" }
    ],
    "responseFieldMappings": {
      "taxTypes[].code": { "type": "column", "column": "vat_type_code" },
      "taxTypes[].description": { "type": "column", "column": "vat_type_description" }
    }
  }
]
