# Tenant Configuration Resilience Tickets

| Ticket ID | Summary | Key Deliverables | Dependencies | Acceptance Criteria |
| --- | --- | --- | --- | --- |
| TC-001 | Implement tenant configuration version store and externalized snapshot storage | Create `tenant_config_versions` table, wire `exportTenantTableDefaults` and seed backup writers to persist metadata and upload SQL payloads to object storage with local cache fallback.【F:db/index.js†L1869-L2056】 | Infra provisioning for object storage | Metadata records created for new exports/backups with stable version IDs; uploads succeed with retry/backoff; local fallback exercised in integration test |
| TC-002 | Expose version catalog APIs for defaults and per-company backups | Add endpoints to list versions, fetch metadata, and request signed download URLs; update controllers to return version IDs after seeding/backups.【F:api-server/controllers/tenantTablesController.js†L124-L305】【F:api-server/controllers/companyController.js†L79-L200】 | TC-001 | API responses include version IDs and metadata, swagger/docs updated, and contract tests cover success and error flows |
| TC-003 | Replace prompt-based TenantTablesRegistry flows with guided backup/restore modals | Build React modals for backup, restore, and dry-run previews, streaming progress events and handling granular errors from new APIs.【F:src/erp.mgt.mn/pages/TenantTablesRegistry.jsx†L388-L959】【F:src/erp.mgt.mn/pages/TenantTablesRegistry.jsx†L1237-L1504】 | TC-001, TC-002 | UI allows naming/tagging backups, shows version history, and surfaces per-table outcomes; Cypress/Playwright tests cover success, cancel, and failure paths |
| TC-004 | Implement automated retention and catalog maintenance | Scheduled job (cron/worker) to prune old versions based on policy, update catalog, emit metrics, and log audit entries.【F:db/index.js†L2050-L2237】【F:db/index.js†L2697-L2795】 | TC-001 | Retention policy configurable; dry-run output available; metrics and audit logs validated in staging |
| TC-005 | Enhance recovery observability and audit logging | Emit structured logs/metrics around seeding, restores, and zero-key resets; capture operator identity and resulting version IDs.【F:api-server/controllers/tenantTablesController.js†L124-L305】【F:db/index.js†L1097-L2694】 | TC-001, TC-002 | Log samples verified in logging stack; dashboards display backup/restore metrics; alert thresholds agreed with SRE |
| TC-006 | Expand automated validation for tenant configuration lifecycle | Add integration tests exercising seed, backup, restore, and retention flows with failure injection (corrupt snapshots, partial writes).【F:db/index.js†L1097-L2694】【F:api-server/controllers/companyController.js†L34-L200】 | TC-003, TC-004 | CI pipeline runs new tests, demonstrating failure detection and clean rollbacks |
