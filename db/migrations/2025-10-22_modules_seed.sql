-- Ensure module columns exist and seed default modules
ALTER TABLE modules
  ADD COLUMN IF NOT EXISTS parent_key VARCHAR(50) NULL,
  ADD COLUMN IF NOT EXISTS show_in_sidebar TINYINT(1) DEFAULT 1,
  ADD COLUMN IF NOT EXISTS show_in_header TINYINT(1) DEFAULT 0;

INSERT INTO modules (module_key, label, parent_key, show_in_sidebar, show_in_header) VALUES
  ('action_permissions', 'Action Permissions', 'developer', 1, 0),
  ('ai_inventory', 'AI Inventory Review', NULL, 1, 0),
  ('ai-inventory', 'ai-inventory', NULL, 1, 0),
  ('change_password', 'Нууц үг солих', 'settings', 1, 0),
  ('coding_tables', 'Кодын хүснэгтүүд', 'developer', 1, 0),
  ('company_licenses', 'Лиценз', 'system_configurations', 1, 0),
  ('dashboard', 'Самбар', NULL, 1, 0),
  ('developer', 'Хөгжүүлэгч', NULL, 1, 0),
  ('error_log', 'Алдааны түүх', 'developer', 1, 0),
  ('finance_transactions', 'САНХҮҮ БҮРТГЭЛ', 'forms', 1, 0),
  ('forms', 'Маягтууд', NULL, 1, 0),
  ('forms_management', 'Маягтын удирдлага', 'system_configurations', 1, 0),
  ('general_configuration', 'Ерөнхий тохиргоо', 'system_configurations', 1, 0),
  ('gl', 'Ерөнхий журнал', NULL, 0, 1),
  ('image_management', 'Image Management', 'system_configurations', 1, 0),
  ('inventory_transaction', 'БАРАА МАТЕРИАЛ', 'forms', 1, 0),
  ('manuals', 'Гарын авлага', NULL, 0, 1),
  ('modules', 'Модуль', 'developer', 1, 0),
  ('planning_transactions', 'АЖЛЫН ТӨЛӨВЛӨЛӨЛТ', 'forms', 1, 0),
  ('po', 'Худалдан авалтын захиалга', NULL, 0, 1),
  ('pos_transaction_management', 'POS Transactions', 'system_configurations', 1, 0),
  ('pos_transactions', 'POS POS', 'forms', 1, 0),
  ('relations_config', 'Хүснэгтийн холболт', 'system_configurations', 1, 0),
  ('report_builder', 'Тайлангийн бүтээгч', 'report_management', 1, 0),
  ('report_management', 'Тайлангийн удирдлага', 'system_configurations', 1, 0),
  ('reports', 'Тайлан', NULL, 1, 0),
  ('requests', 'Хүсэлтүүд', NULL, 1, NULL),
  ('role_permissions', 'Эрхийн тохиргоо', 'system_configurations', 1, 0),
  ('sales', 'Борлуулалтын самбар', NULL, 0, 1),
  ('settings', 'Тохиргоо', NULL, 1, 0),
  ('system_configurations', 'Системийн тохиргоо', NULL, 1, 0),
  ('tables_management', 'Хүснэгтийн удирдлага', 'developer', 1, 0),
  ('transactions_contract', 'Гэрээ', 'forms', 1, 0),
  ('user_companies', 'Хэрэглэгчийн компаниуд', 'system_configurations', 1, 0),
  ('user_level_actions', 'User Level Actions', 'developer', 1, 0),
  ('user_settings', 'Хэрэглэгчийн удирдлага', 'system_configurations', 1, 0),
  ('users', 'Хэрэглэгчид', 'system_configurations', 1, 0)
ON DUPLICATE KEY UPDATE
  label = VALUES(label),
  parent_key = VALUES(parent_key),
  show_in_sidebar = VALUES(show_in_sidebar),
  show_in_header = VALUES(show_in_header);
